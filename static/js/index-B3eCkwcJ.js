var ie=Object.defineProperty,ue=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var H=(f,v,n)=>v in f?ie(f,v,{enumerable:!0,configurable:!0,writable:!0,value:n}):f[v]=n,O=(f,v)=>{for(var n in v||(v={}))re.call(v,n)&&H(f,n,v[n]);if(J)for(var n of J(v))de.call(v,n)&&H(f,n,v[n]);return f},j=(f,v)=>ue(f,se(v));import{S as pe}from"./sortable.esm-DLvoQ0uI.js";import{c as me,h as ve,a as fe,o as A,R as ce,b as be,d as ge}from"./index-C1ZunDW2.js";import{n as h,b as e,r,f as c,aF as _e,aG as D,Y as ke,d as I,aH as K,aI as Ce,J as he,t as ye,g as P,h as t,o as L,e as w,x as Ve,c as T,u as s,V as z,Q as xe,j as Le,aJ as F,w as q,_ as we}from"./index-iKu4C4P4.js";function Se(f){const v=o=>{o.preventDefault(),ke(()=>{const m=document.querySelector(".el-table__body-wrapper tbody");pe.create(m,{animation:300,handle:".drag-btn",onEnd:({newIndex:S,oldIndex:V})=>{const p=n.value.list.splice(V,1)[0];n.value.list.splice(S,0,p)}})})},n=h({list:[],isLoading:!1}),b=h({title:"",month:"",baiduLink:""});f.isStarCoin&&(b.value.starCoin="0");function i(){n.value.isLoading=!0;const o={};for(let m in b.value)b.value[m]&&(o[m]=b.value[m]);ve(o).then(m=>{n.value.list=m}).finally(()=>{n.value.isLoading=!1})}const k=h([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:o})=>e("div",{class:"flex items-center"},[e(r("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:m=>v(m)},null),e("p",{class:"ml-[16px]"},[o.id])])},{label:"封面",prop:"img",slot:"img",width:60},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"星币数",prop:"starCoin",cellRenderer:({row:o})=>o.starCoin>0?o.starCoin:"免费"},{label:"状态",prop:"status",cellRenderer:({row:o})=>o.status?e(r("el-tag"),{type:"primary"},{default:()=>[c("上架")]}):e(r("el-tag"),{type:"danger"},{default:()=>[c("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),U=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],y=h([]);function _(o){y.value=[],y.value=o.map(({_id:m})=>m)}function a(o){_e.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{fe({id:o}).then(()=>{D.success("删除成功"),i()})}).catch(()=>{D.info("已取消删除")})}function C(o){var m;A[o]&&((m=A[o]({ids:JSON.stringify(y.value)}))==null||m.then(()=>{D.success("操作成功"),i()}))}function d(o){A.upper({ids:JSON.stringify([o])}).then(()=>{D.success("操作成功"),i()})}function g(o){A.upper({ids:JSON.stringify([o])}).then(()=>{D.success("操作成功"),i()})}return{columns:k,tableData:n,options:U,searchModel:b,handleSelectionChange:_,loadData:i,copyTextToClipboard:me,handDelete:a,headOperationAll:C,handUpper:d,handLower:g}}const Re={class:"dialog-footer"},Ue=I({__name:"DialogForm",props:K({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:K(["refresh"],["update:modelValue"]),setup(f,{emit:v}){const n=Ce(f,"modelValue"),b=f,i=h({_id:"",starCoin:0,title:"",month:"",festival:"",baiduLink:"",img:[]});he(()=>n.value,()=>{var _;i.value=j(O({},b.data),{starCoin:Number(b.data.starCoin||0),img:(_=b.data.img)==null?void 0:_.map(a=>({url:a,status:"success"}))})});const k=v,U=ye({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],month:[{required:!0,message:"不可以为空"}],img:[{type:"array",required:!0,message:"不可以为空"}],festival:[{required:!0,message:"不可以为空"}]});function y(){var C;const _=j(O({},i.value),{img:i.value.img.map(d=>{var g;return((g=d==null?void 0:d.response)==null?void 0:g.file)||d.url})}),a=new FormData;for(const d in _)Object.prototype.hasOwnProperty.call(_,d)&&(d=="img"?_[d].forEach((g,o)=>{a.append(`img[${o}]`,g)}):a.append(d,_[d]));(C=i.value)!=null&&C._id?(a.append("id",i.value._id),be(a).then(()=>{n.value=!1,k("refresh")})):ge(a).then(()=>{n.value=!1,k("refresh")})}return(_,a)=>{var V;const C=r("el-input-number"),d=r("el-form-item"),g=r("el-input"),o=r("el-form"),m=r("el-button"),S=r("el-dialog");return L(),P(S,{modelValue:n.value,"onUpdate:modelValue":a[7]||(a[7]=p=>n.value=p),title:`${(V=b.data)!=null&&V._id?"编辑":"新增"}手抄报`,width:"500"},{footer:t(()=>[w("div",Re,[e(m,{onClick:a[6]||(a[6]=p=>n.value=!1)},{default:t(()=>a[9]||(a[9]=[c("取消")])),_:1}),e(m,{type:"primary",onClick:y},{default:t(()=>a[10]||(a[10]=[c(" 确认 ")])),_:1})])]),default:t(()=>[e(o,{ref:"ruleFormRef","label-position":"top",model:i.value,rules:U,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:t(()=>[e(d,{label:"星币",prop:"starCoin"},{default:t(()=>[e(C,{modelValue:i.value.starCoin,"onUpdate:modelValue":a[0]||(a[0]=p=>i.value.starCoin=p),min:0,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"标题",prop:"title"},{default:t(()=>[e(g,{modelValue:i.value.title,"onUpdate:modelValue":a[1]||(a[1]=p=>i.value.title=p),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"月分",prop:"month"},{default:t(()=>[e(g,{modelValue:i.value.month,"onUpdate:modelValue":a[2]||(a[2]=p=>i.value.month=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"节曰",prop:"festival"},{default:t(()=>[e(g,{modelValue:i.value.festival,"onUpdate:modelValue":a[3]||(a[3]=p=>i.value.festival=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"百度云链接",prop:"baiduLink"},{default:t(()=>[e(g,{modelValue:i.value.baiduLink,"onUpdate:modelValue":a[4]||(a[4]=p=>i.value.baiduLink=p),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{prop:"img"},{label:t(()=>a[8]||(a[8]=[c(" 上传 ")])),default:t(()=>[e(ce,{modelValue:i.value.img,"onUpdate:modelValue":a[5]||(a[5]=p=>i.value.img=p),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Be={class:"flex"},De={class:"head"},Te={key:0,class:"imgBox"},$e={class:"table_operation"},Ae=I({name:"thandCopyList",__name:"index",props:{isStarCoin:{default:!1}},setup(f){const v=f,{columns:n,tableData:b,options:i,searchModel:k,handleSelectionChange:U,loadData:y,copyTextToClipboard:_,handDelete:a,headOperationAll:C,handUpper:d,handLower:g}=Se(v);Ve(()=>{y()});const o=h([]),m=h(),S=h(),V=()=>{var x,l;(l=(x=s(S).popperRef)==null?void 0:x.delayHide)==null||l.call(x)},p=h(!1),M=h({});function Y(x){p.value=!0,M.value=x}function G(){p.value=!0,M.value={}}return(x,l)=>{const E=r("el-input"),R=r("el-button"),Q=r("el-image"),W=r("el-tag"),X=r("Link"),B=r("el-icon"),Z=r("Remove"),ee=r("Top"),le=r("Bottom"),ae=r("Edit"),te=r("pure-table"),oe=r("el-cascader-panel"),ne=r("el-popover"),N=Le("click-outside");return L(),T(xe,null,[w("div",Be,[w("div",De,[l[15]||(l[15]=w("div",null,"手抄报列表",-1)),w("div",null,[e(E,{modelValue:s(k).title,"onUpdate:modelValue":l[0]||(l[0]=u=>s(k).title=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:s(k).month,"onUpdate:modelValue":l[1]||(l[1]=u=>s(k).month=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:s(k).baiduLink,"onUpdate:modelValue":l[2]||(l[2]=u=>s(k).baiduLink=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(R,{type:"primary",onClick:s(y)},{default:t(()=>l[9]||(l[9]=[c("搜索")])),_:1},8,["onClick"]),e(R,{onClick:l[3]||(l[3]=u=>s(C)("upper"))},{default:t(()=>l[10]||(l[10]=[c("批量上架")])),_:1}),e(R,{onClick:l[4]||(l[4]=u=>s(C)("lower"))},{default:t(()=>l[11]||(l[11]=[c("批量下架")])),_:1}),v.isStarCoin?(L(),P(R,{key:0,onClick:l[5]||(l[5]=u=>s(C)("delete"))},{default:t(()=>l[12]||(l[12]=[c("批量删除")])),_:1})):z("",!0),e(R,{type:"primary",onClick:l[6]||(l[6]=u=>s(C)("free"))},{default:t(()=>l[13]||(l[13]=[c(" 设置免费 ")])),_:1}),e(R,{type:"primary",onClick:G},{default:t(()=>l[14]||(l[14]=[c("新增")])),_:1})])]),e(te,{"row-key":"id",data:s(b).list,loading:s(b).isLoading,columns:s(n),onSelectionChange:s(U)},{img:t(({row:u})=>[u!=null&&u.img?(L(),T("div",Te,[e(Q,{"preview-teleported":!0,src:u.img[0],fit:"fill","preview-src-list":u.img},null,8,["src","preview-src-list"])])):z("",!0)]),jointLevel1:t(()=>[q((L(),T("div",{ref_key:"buttonRef",ref:m},l[16]||(l[16]=[c("一级分类")]))),[[N,V]])]),jointLevel2:t(()=>[q((L(),T("div",null,l[17]||(l[17]=[c("二级分类")]))),[[N,V]])]),jointLevel3:t(()=>[q((L(),T("div",null,l[18]||(l[18]=[c("三级分类")]))),[[N,V]])]),state:t(()=>[e(W,{type:"primary"},{default:t(()=>l[19]||(l[19]=[c("状态")])),_:1})]),operation:t(({row:u})=>[w("div",$e,[e(B,{onClick:$=>s(_)(u.baiduLink)},{default:t(()=>[e(X)]),_:2},1032,["onClick"]),e(B,{onClick:$=>s(a)(u._id)},{default:t(()=>[e(Z)]),_:2},1032,["onClick"]),e(B,{onClick:$=>s(d)(u._id)},{default:t(()=>[e(ee)]),_:2},1032,["onClick"]),e(B,{onClick:$=>s(g)(u._id)},{default:t(()=>[e(le)]),_:2},1032,["onClick"]),e(B,{onClick:$=>Y(u)},{default:t(()=>[e(ae)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),e(ne,{ref_key:"popoverRef",ref:S,"virtual-ref":m.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:t(()=>[w("div",null,[e(oe,{modelValue:o.value,"onUpdate:modelValue":l[7]||(l[7]=u=>o.value=u),props:{multiple:!0},options:s(i)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),e(Ue,{modelValue:p.value,"onUpdate:modelValue":l[8]||(l[8]=u=>p.value=u),data:M.value,onRefresh:s(y)},null,8,["modelValue","data","onRefresh"])],64)}}}),je=we(Ae,[["__scopeId","data-v-abbc7b8c"]]);export{je as default};
