var ue=Object.defineProperty,se=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var H=(m,p,o)=>p in m?ue(m,p,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[p]=o,O=(m,p)=>{for(var o in p||(p={}))de.call(p,o)&&H(m,o,p[o]);if(J)for(var o of J(p))pe.call(p,o)&&H(m,o,p[o]);return m},j=(m,p)=>se(m,re(p));var K=(m,p,o)=>new Promise((b,i)=>{var _=k=>{try{f(o.next(k))}catch(c){i(c)}},L=k=>{try{f(o.throw(k))}catch(c){i(c)}},f=k=>k.done?b(k.value):Promise.resolve(k.value).then(_,L);f((o=o.apply(m,p)).next())});import{S as me}from"./sortable.esm-DLvoQ0uI.js";import{c as ve,h as fe,a as ce,o as M,R as be,b as ge,d as _e}from"./index-CwcXiyvp.js";import{n as C,b as e,r as d,f as g,aF as ke,aG as T,Y as ye,d as P,aH as z,aI as Ce,J as he,t as Ve,g as Y,h as n,o as R,e as U,x as xe,c as $,u as s,V as I,Q as Le,j as we,aJ as F,w as q,_ as Se}from"./index-BY7pdI-H.js";function Re(m){const p=l=>{l.preventDefault(),ye(()=>{const r=document.querySelector(".el-table__body-wrapper tbody");me.create(r,{animation:300,handle:".drag-btn",onEnd:({newIndex:h,oldIndex:w})=>{const V=o.value.list.splice(w,1)[0];o.value.list.splice(h,0,V)}})})},o=C({list:[],isLoading:!1}),b=C({title:"",month:"",baiduLink:""});m.isStarCoin&&(b.value.starCoin="0");function i(){o.value.isLoading=!0;const l={};for(let r in b.value)b.value[r]&&(l[r]=b.value[r]);fe(l).then(r=>{o.value.list=r}).finally(()=>{o.value.isLoading=!1})}const _=C([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:l})=>e("div",{class:"flex items-center"},[e(d("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:r=>p(r)},null),e("p",{class:"ml-[16px]"},[l.id])])},{label:"封面",prop:"img",slot:"img",width:60},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"星币数",prop:"starCoin",cellRenderer:({row:l})=>l.starCoin>0?l.starCoin:"免费"},{label:"状态",prop:"status",cellRenderer:({row:l})=>l.status?e(d("el-tag"),{type:"primary"},{default:()=>[g("上架")]}):e(d("el-tag"),{type:"danger"},{default:()=>[g("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),L=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],f=C([]);function k(l){f.value=[],f.value=l.map(({_id:r})=>r)}function c(l){ke.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ce({id:l}).then(()=>{T.success("删除成功"),i()})}).catch(()=>{T.info("已取消删除")})}function t(l){var r;M[l]&&((r=M[l]({ids:JSON.stringify(f.value)}))==null||r.then(()=>{T.success("操作成功"),i()}))}function x(l){M.upper({ids:JSON.stringify([l])}).then(()=>{T.success("操作成功"),i()})}function y(l){M.lower({ids:JSON.stringify([l])}).then(()=>{T.success("操作成功"),i()})}return{columns:_,tableData:o,options:L,searchModel:b,handleSelectionChange:k,loadData:i,copyTextToClipboard:ve,handDelete:c,headOperationAll:t,handUpper:x,handLower:y}}const Ue={class:"dialog-footer"},Be=P({__name:"DialogForm",props:z({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:z(["refresh"],["update:modelValue"]),setup(m,{emit:p}){const o=Ce(m,"modelValue"),b=m,i=C({_id:"",starCoin:0,title:"",month:"",festival:"",baiduLink:"",img:[]});he(()=>o.value,()=>{var c;i.value=j(O({},b.data),{starCoin:Number(b.data.starCoin||0),img:(c=b.data.img)==null?void 0:c.map(t=>({url:t,status:"success"}))})});const _=p,L=Ve({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],month:[{required:!0,message:"不可以为空"}],img:[{type:"array",required:!0,message:"不可以为空"}],festival:[{required:!0,message:"不可以为空"}]}),f=C(!1);function k(){return K(this,null,function*(){var x,y;f.value=!0;const c=j(O({},i.value),{img:(x=i.value.img)==null?void 0:x.filter(l=>l.status=="success").map(l=>{var r;return((r=l==null?void 0:l.response)==null?void 0:r.file)||l.url})}),t=new FormData;for(const l in c)Object.prototype.hasOwnProperty.call(c,l)&&(l=="img"?c[l].forEach((r,h)=>{t.append(`img[${h}]`,r)}):t.append(l,c[l]));(y=i.value)!=null&&y._id?(t.append("id",i.value._id),ge(t).then(()=>{o.value=!1,_("refresh")}).finally(()=>{f.value=!1})):_e(t).then(()=>{o.value=!1,_("refresh")}).finally(()=>{f.value=!1})})}return(c,t)=>{var V;const x=d("el-input-number"),y=d("el-form-item"),l=d("el-input"),r=d("el-form"),h=d("el-button"),w=d("el-dialog");return R(),Y(w,{modelValue:o.value,"onUpdate:modelValue":t[7]||(t[7]=v=>o.value=v),title:`${(V=b.data)!=null&&V._id?"编辑":"新增"}手抄报`,width:"500"},{footer:n(()=>[U("div",Ue,[e(h,{onClick:t[6]||(t[6]=v=>o.value=!1)},{default:n(()=>t[9]||(t[9]=[g("取消")])),_:1}),e(h,{type:"primary",loading:f.value,onClick:k},{default:n(()=>t[10]||(t[10]=[g(" 确认 ")])),_:1},8,["loading"])])]),default:n(()=>[e(r,{ref:"ruleFormRef","label-position":"top",model:i.value,rules:L,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:n(()=>[e(y,{label:"星币",prop:"starCoin"},{default:n(()=>[e(x,{modelValue:i.value.starCoin,"onUpdate:modelValue":t[0]||(t[0]=v=>i.value.starCoin=v),min:0,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(y,{label:"标题",prop:"title"},{default:n(()=>[e(l,{modelValue:i.value.title,"onUpdate:modelValue":t[1]||(t[1]=v=>i.value.title=v),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(y,{label:"月分",prop:"month"},{default:n(()=>[e(l,{modelValue:i.value.month,"onUpdate:modelValue":t[2]||(t[2]=v=>i.value.month=v),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(y,{label:"节曰",prop:"festival"},{default:n(()=>[e(l,{modelValue:i.value.festival,"onUpdate:modelValue":t[3]||(t[3]=v=>i.value.festival=v),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(y,{label:"百度云链接",prop:"baiduLink"},{default:n(()=>[e(l,{modelValue:i.value.baiduLink,"onUpdate:modelValue":t[4]||(t[4]=v=>i.value.baiduLink=v),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(y,{prop:"img"},{label:n(()=>t[8]||(t[8]=[g(" 上传 ")])),default:n(()=>[e(be,{modelValue:i.value.img,"onUpdate:modelValue":t[5]||(t[5]=v=>i.value.img=v),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),De={class:"flex"},Te={class:"head"},$e={key:0,class:"imgBox"},Ae={class:"table_operation"},Me=P({name:"thandCopyList",__name:"index",props:{isStarCoin:{default:!1}},setup(m){const p=m,{columns:o,tableData:b,options:i,searchModel:_,handleSelectionChange:L,loadData:f,copyTextToClipboard:k,handDelete:c,headOperationAll:t,handUpper:x,handLower:y}=Re(p);xe(()=>{f()});const l=C([]),r=C(),h=C(),w=()=>{var S,a;(a=(S=s(h).popperRef)==null?void 0:S.delayHide)==null||a.call(S)},V=C(!1),v=C({});function G(S){V.value=!0,v.value=S}function Q(){V.value=!0,v.value={}}return(S,a)=>{const E=d("el-input"),B=d("el-button"),W=d("el-image"),X=d("el-tag"),Z=d("Link"),D=d("el-icon"),ee=d("Remove"),le=d("Top"),ae=d("Bottom"),te=d("Edit"),oe=d("pure-table"),ne=d("el-cascader-panel"),ie=d("el-popover"),N=we("click-outside");return R(),$(Le,null,[U("div",De,[U("div",Te,[a[15]||(a[15]=U("div",null,"手抄报列表",-1)),U("div",null,[e(E,{modelValue:s(_).title,"onUpdate:modelValue":a[0]||(a[0]=u=>s(_).title=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:s(_).month,"onUpdate:modelValue":a[1]||(a[1]=u=>s(_).month=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:s(_).baiduLink,"onUpdate:modelValue":a[2]||(a[2]=u=>s(_).baiduLink=u),"suffix-icon":s(F),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(B,{type:"primary",onClick:s(f)},{default:n(()=>a[9]||(a[9]=[g("搜索")])),_:1},8,["onClick"]),e(B,{onClick:a[3]||(a[3]=u=>s(t)("upper"))},{default:n(()=>a[10]||(a[10]=[g("批量上架")])),_:1}),e(B,{onClick:a[4]||(a[4]=u=>s(t)("lower"))},{default:n(()=>a[11]||(a[11]=[g("批量下架")])),_:1}),p.isStarCoin?(R(),Y(B,{key:0,onClick:a[5]||(a[5]=u=>s(t)("delete"))},{default:n(()=>a[12]||(a[12]=[g("批量删除")])),_:1})):I("",!0),e(B,{type:"primary",onClick:a[6]||(a[6]=u=>s(t)("free"))},{default:n(()=>a[13]||(a[13]=[g(" 设置免费 ")])),_:1}),e(B,{type:"primary",onClick:Q},{default:n(()=>a[14]||(a[14]=[g("新增")])),_:1})])]),e(oe,{"row-key":"id",data:s(b).list,loading:s(b).isLoading,columns:s(o),onSelectionChange:s(L)},{img:n(({row:u})=>[u!=null&&u.img?(R(),$("div",$e,[e(W,{"preview-teleported":!0,src:u.img[0],fit:"fill","preview-src-list":u.img},null,8,["src","preview-src-list"])])):I("",!0)]),jointLevel1:n(()=>[q((R(),$("div",{ref_key:"buttonRef",ref:r},a[16]||(a[16]=[g("一级分类")]))),[[N,w]])]),jointLevel2:n(()=>[q((R(),$("div",null,a[17]||(a[17]=[g("二级分类")]))),[[N,w]])]),jointLevel3:n(()=>[q((R(),$("div",null,a[18]||(a[18]=[g("三级分类")]))),[[N,w]])]),state:n(()=>[e(X,{type:"primary"},{default:n(()=>a[19]||(a[19]=[g("状态")])),_:1})]),operation:n(({row:u})=>[U("div",Ae,[e(D,{onClick:A=>s(k)(u.baiduLink)},{default:n(()=>[e(Z)]),_:2},1032,["onClick"]),e(D,{onClick:A=>s(c)(u._id)},{default:n(()=>[e(ee)]),_:2},1032,["onClick"]),e(D,{onClick:A=>s(x)(u._id)},{default:n(()=>[e(le)]),_:2},1032,["onClick"]),e(D,{onClick:A=>s(y)(u._id)},{default:n(()=>[e(ae)]),_:2},1032,["onClick"]),e(D,{onClick:A=>G(u)},{default:n(()=>[e(te)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),e(ie,{ref_key:"popoverRef",ref:h,"virtual-ref":r.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:n(()=>[U("div",null,[e(ne,{modelValue:l.value,"onUpdate:modelValue":a[7]||(a[7]=u=>l.value=u),props:{multiple:!0},options:s(i)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),e(Be,{modelValue:V.value,"onUpdate:modelValue":a[8]||(a[8]=u=>V.value=u),data:v.value,onRefresh:s(f)},null,8,["modelValue","data","onRefresh"])],64)}}}),Fe=Se(Me,[["__scopeId","data-v-abbc7b8c"]]);export{Fe as default};
