var ae=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var F=(v,u,r)=>u in v?ae(v,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[u]=r,$=(v,u)=>{for(var r in u||(u={}))ne.call(u,r)&&F(v,r,u[r]);if(q)for(var r of q(u))ie.call(u,r)&&F(v,r,u[r]);return v},M=(v,u)=>te(v,oe(u));import{S as ue}from"./sortable.esm-DLvoQ0uI.js";import{c as re,h as se,a as de,o as N,R as pe,b as me,d as ve}from"./index-CbJo9NPj.js";import{n as _,b as l,r as p,f,ay as fe,az as E,Y as be,d as K,aA as z,aB as ce,J as ge,t as _e,g as Ve,h as o,o as h,e as L,x as ke,c as x,u as d,Q as J,j as ye,aC as j,R as he,V as Ce,w as O,_ as xe}from"./index-oC8DoOwB.js";function Le(){const v=i=>{i.preventDefault(),be(()=>{const t=document.querySelector(".el-table__body-wrapper tbody");ue.create(t,{animation:300,handle:".drag-btn",onEnd:({newIndex:c,oldIndex:g})=>{const y=u.value.list.splice(g,1)[0];u.value.list.splice(c,0,y)}})})},u=_({list:[],isLoading:!1}),r=_({title:"",month:"",baiduLink:""});function V(){u.value.isLoading=!0,se(r.value).then(i=>{u.value.list=i.map(t=>(typeof t.img=="string"&&(t.img=t.img.split(",")),t))}).finally(()=>{u.value.isLoading=!1})}const n=_([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:i})=>l("div",{class:"flex items-center"},[l(p("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:t=>v(t)},null),l("p",{class:"ml-[16px]"},[i.id])])},{label:"封面",prop:"img",slot:"img"},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"格式",prop:"name"},{label:"状态",prop:"status",cellRenderer:({row:i})=>i.status?l(p("el-tag"),{type:"primary"},{default:()=>[f("上架")]}):l(p("el-tag"),{type:"danger"},{default:()=>[f("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),w=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],k=_([]);function B(i){k.value=[],k.value=i.map(({_id:t})=>t)}function b(i){fe.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{de({id:i}).then(()=>{E.success("删除成功"),V()})}).catch(()=>{E.info("已取消删除")})}function a(i){var t;N[i]&&((t=N[i]({ids:JSON.stringify(k.value)}))==null||t.then(()=>{E.success("操作成功"),V()}))}return{columns:n,tableData:u,options:w,searchModel:r,handleSelectionChange:B,loadData:V,copyTextToClipboard:re,handDelete:b,headOperationAll:a}}const we={class:"dialog-footer"},Re=K({__name:"DialogForm",props:z({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:z(["refresh"],["update:modelValue"]),setup(v,{emit:u}){const r=ce(v,"modelValue"),V=v,n=_({_id:"",starCoin:"",title:"",month:"",festival:"",baiduLink:"",img:[]});ge(()=>r.value,()=>{var b;n.value=M($({},V.data),{img:(b=V.data.img)==null?void 0:b.map(a=>({url:a,status:"success"}))})});const w=u,k=_e({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],month:[{required:!0,message:"不可以为空"}],img:[{type:"array",required:!0,message:"不可以为空"}],festival:[{required:!0,message:"不可以为空"}]});function B(){var i;const b=M($({},n.value),{img:n.value.img.map(t=>{var c;return((c=t==null?void 0:t.response)==null?void 0:c.file)||t.url})}),a=new FormData;for(const t in b)Object.prototype.hasOwnProperty.call(b,t)&&(t=="img"?b[t].forEach((c,g)=>{a.append(`img[${g}]`,c)}):a.append(t,b[t]));(i=n.value)!=null&&i._id?(a.append("id",n.value._id),me(a).then(()=>{r.value=!1,w("refresh")})):ve(a).then(()=>{r.value=!1,w("refresh")})}return(b,a)=>{var U;const i=p("el-input"),t=p("el-form-item"),c=p("el-form"),g=p("el-button"),y=p("el-dialog");return h(),Ve(y,{modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=m=>r.value=m),title:`${(U=V.data)!=null&&U.id?"新增":"编辑"}手抄报`,width:"500"},{footer:o(()=>[L("div",we,[l(g,{onClick:a[6]||(a[6]=m=>r.value=!1)},{default:o(()=>a[9]||(a[9]=[f("取消")])),_:1}),l(g,{type:"primary",onClick:B},{default:o(()=>a[10]||(a[10]=[f(" 确认 ")])),_:1})])]),default:o(()=>[l(c,{ref:"ruleFormRef","label-position":"top",model:n.value,rules:k,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:o(()=>[l(t,{label:"星币",prop:"starCoin"},{default:o(()=>[l(i,{modelValue:n.value.starCoin,"onUpdate:modelValue":a[0]||(a[0]=m=>n.value.starCoin=m),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(t,{label:"标题",prop:"title"},{default:o(()=>[l(i,{modelValue:n.value.title,"onUpdate:modelValue":a[1]||(a[1]=m=>n.value.title=m),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(t,{label:"月分",prop:"month"},{default:o(()=>[l(i,{modelValue:n.value.month,"onUpdate:modelValue":a[2]||(a[2]=m=>n.value.month=m),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(t,{label:"节曰",prop:"festival"},{default:o(()=>[l(i,{modelValue:n.value.festival,"onUpdate:modelValue":a[3]||(a[3]=m=>n.value.festival=m),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(t,{label:"百度云链接",prop:"baiduLink"},{default:o(()=>[l(i,{modelValue:n.value.baiduLink,"onUpdate:modelValue":a[4]||(a[4]=m=>n.value.baiduLink=m),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(t,{prop:"img"},{label:o(()=>a[8]||(a[8]=[f(" 上传 ")])),default:o(()=>[l(pe,{modelValue:n.value.img,"onUpdate:modelValue":a[5]||(a[5]=m=>n.value.img=m),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Be={class:"flex"},Ue={class:"head"},De={key:0},Se={class:"table_operation"},Te=K({name:"thandCopyList",__name:"index",setup(v){const{columns:u,tableData:r,options:V,searchModel:n,handleSelectionChange:w,loadData:k,copyTextToClipboard:B,handDelete:b,headOperationAll:a}=Le();ke(()=>{k()});const i=_([]),t=_(),c=_(),g=()=>{var C,e;(e=(C=d(c).popperRef)==null?void 0:C.delayHide)==null||e.call(C)},y=_(!1),U=_({});function m(C){y.value=!0,U.value=C}return(C,e)=>{const T=p("el-input"),R=p("el-button"),H=p("el-image"),P=p("el-tag"),Y=p("Link"),D=p("el-icon"),I=p("Remove"),Q=p("Top"),W=p("Bottom"),G=p("Edit"),X=p("pure-table"),Z=p("el-cascader-panel"),ee=p("el-popover"),A=ye("click-outside");return h(),x(J,null,[L("div",Be,[L("div",Ue,[e[16]||(e[16]=L("div",null,"手抄报列表",-1)),L("div",null,[l(T,{modelValue:d(n).title,"onUpdate:modelValue":e[0]||(e[0]=s=>d(n).title=s),"suffix-icon":d(j),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l(T,{modelValue:d(n).month,"onUpdate:modelValue":e[1]||(e[1]=s=>d(n).month=s),"suffix-icon":d(j),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),l(T,{modelValue:d(n).baiduLink,"onUpdate:modelValue":e[2]||(e[2]=s=>d(n).baiduLink=s),"suffix-icon":d(j),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l(R,{type:"primary",onClick:d(k)},{default:o(()=>e[10]||(e[10]=[f("搜索")])),_:1},8,["onClick"]),l(R,{onClick:e[3]||(e[3]=s=>d(a)("upper"))},{default:o(()=>e[11]||(e[11]=[f("批量上架")])),_:1}),l(R,{onClick:e[4]||(e[4]=s=>d(a)("lower"))},{default:o(()=>e[12]||(e[12]=[f("批量下架")])),_:1}),l(R,{onClick:e[5]||(e[5]=s=>d(a)("delete"))},{default:o(()=>e[13]||(e[13]=[f("批量删除")])),_:1}),l(R,{type:"primary",onClick:e[6]||(e[6]=s=>d(a)("free"))},{default:o(()=>e[14]||(e[14]=[f(" 设置免费 ")])),_:1}),l(R,{type:"primary",onClick:e[7]||(e[7]=s=>y.value=!0)},{default:o(()=>e[15]||(e[15]=[f("新增")])),_:1})])]),l(X,{"row-key":"id",data:d(r).list,loading:d(r).isLoading,columns:d(u),onSelectionChange:d(w)},{img:o(({row:s})=>[s!=null&&s.img?(h(),x("div",De,[(h(!0),x(J,null,he(s.img,(S,le)=>(h(),x("div",{key:le},[l(H,{src:S},null,8,["src"])]))),128))])):Ce("",!0)]),jointLevel1:o(()=>[O((h(),x("div",{ref_key:"buttonRef",ref:t},e[17]||(e[17]=[f("一级分类")]))),[[A,g]])]),jointLevel2:o(()=>[O((h(),x("div",null,e[18]||(e[18]=[f("二级分类")]))),[[A,g]])]),jointLevel3:o(()=>[O((h(),x("div",null,e[19]||(e[19]=[f("三级分类")]))),[[A,g]])]),state:o(()=>[l(P,{type:"primary"},{default:o(()=>e[20]||(e[20]=[f("状态")])),_:1})]),operation:o(({row:s})=>[L("div",Se,[l(D,{onClick:S=>d(B)(s.baiduLink)},{default:o(()=>[l(Y)]),_:2},1032,["onClick"]),l(D,{onClick:S=>d(b)(s._id)},{default:o(()=>[l(I)]),_:2},1032,["onClick"]),l(D,null,{default:o(()=>[l(Q)]),_:1}),l(D,null,{default:o(()=>[l(W)]),_:1}),l(D,{onClick:S=>m(s)},{default:o(()=>[l(G)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),l(ee,{ref_key:"popoverRef",ref:c,"virtual-ref":t.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:o(()=>[L("div",null,[l(Z,{modelValue:i.value,"onUpdate:modelValue":e[8]||(e[8]=s=>i.value=s),props:{multiple:!0},options:d(V)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),l(Re,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=s=>y.value=s),data:U.value,onRefresh:d(k)},null,8,["modelValue","data","onRefresh"])],64)}}}),je=xe(Te,[["__scopeId","data-v-3253678a"]]);export{je as default};
