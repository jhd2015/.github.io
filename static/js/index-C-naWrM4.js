var re=Object.defineProperty,de=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var z=(f,p,o)=>p in f?re(f,p,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[p]=o,j=(f,p)=>{for(var o in p||(p={}))me.call(p,o)&&z(f,o,p[o]);if(K)for(var o of K(p))ve.call(p,o)&&z(f,o,p[o]);return f},q=(f,p)=>de(f,pe(p));var I=(f,p,o)=>new Promise((c,i)=>{var h=g=>{try{b(o.next(g))}catch(L){i(L)}},F=g=>{try{b(o.throw(g))}catch(L){i(L)}},b=g=>g.done?c(g.value):Promise.resolve(g.value).then(h,F);b((o=o.apply(f,p)).next())});import{S as fe}from"./sortable.esm-DLvoQ0uI.js";import{c as ce,h as be,a as ge,o as E,g as _e,R as he,b as ye,d as ke}from"./index-DeDFb6Sj.js";import{n as k,b as l,r as d,f as _,aF as Ce,aG as A,Y as G,d as Q,aH as P,aI as Ve,J as xe,t as Le,x as W,g as X,h as n,o as R,e as B,c as $,u as r,V as Y,Q as we,j as Se,aJ as J,w as H,_ as Fe}from"./index-exbkcW60.js";function Re(f){const p=t=>{t.preventDefault(),G(()=>{const s=document.querySelector(".el-table__body-wrapper tbody");fe.create(s,{animation:300,handle:".drag-btn",onEnd:({newIndex:y,oldIndex:x})=>{const C=o.value.list.splice(x,1)[0];o.value.list.splice(y,0,C)}})})},o=k({list:[],isLoading:!1}),c=k({title:"",month:"",baiduLink:""});f.isStarCoin&&(c.value.starCoin="0");function i(){o.value.isLoading=!0;const t={};for(let s in c.value)c.value[s]&&(t[s]=c.value[s]);be(t).then(s=>{o.value.list=s}).finally(()=>{o.value.isLoading=!1})}const h=k([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:t})=>l("div",{class:"flex items-center"},[l(d("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:s=>p(s)},null),l("p",{class:"ml-[16px]"},[t.id])])},{label:"封面",prop:"img",slot:"img",width:60},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"星币数",prop:"starCoin",cellRenderer:({row:t})=>t.starCoin>0?t.starCoin:"免费"},{label:"状态",prop:"status",cellRenderer:({row:t})=>t.status?l(d("el-tag"),{type:"primary"},{default:()=>[_("上架")]}):l(d("el-tag"),{type:"danger"},{default:()=>[_("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),F=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],b=k([]);function g(t){b.value=[],b.value=t.map(({_id:s})=>s)}function L(t){Ce.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ge({id:t}).then(()=>{A.success("删除成功"),i()})}).catch(()=>{A.info("已取消删除")})}function w(t){var s;E[t]&&((s=E[t]({ids:JSON.stringify(b.value)}))==null||s.then(()=>{A.success("操作成功"),i()}))}function V(t){E.upper({ids:JSON.stringify([t])}).then(()=>{A.success("操作成功"),i()})}function a(t){E.lower({ids:JSON.stringify([t])}).then(()=>{A.success("操作成功"),i()})}return{columns:h,tableData:o,options:F,searchModel:c,handleSelectionChange:g,loadData:i,copyTextToClipboard:ce,handDelete:L,headOperationAll:w,handUpper:V,handLower:a}}const Be={class:"dialog-footer"},Ue=Q({__name:"DialogForm",props:P({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[],monthFestival:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:P(["refresh"],["update:modelValue"]),setup(f,{emit:p}){const o=Ve(f,"modelValue"),c=f,i=k({_id:"",starCoin:0,title:"",month:"",festival:"",baiduLink:"",img:[],monthFestival:[]});xe(()=>o.value,()=>{G(()=>{var V;i.value=q(j({},c.data),{monthFestival:[c.data.month,c.data.festival].filter(a=>a),starCoin:Number(c.data.starCoin||0),img:(V=c.data.img)==null?void 0:V.map(a=>({url:a,status:"success"}))}),g.value.resetFields()})});const h=p,F=Le({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],monthFestival:[{required:!0,message:"不可以为空",type:"array",trigger:"change"}],img:[{type:"array",required:!0,message:"不可以为空"}]}),b=k(!1),g=k();function L(){return I(this,null,function*(){var x,C;if(yield g.value.validate())return;b.value=!0;const[a,t]=i.value.monthFestival,s=q(j({},i.value),{monthFestival:void 0,month:a,festival:t,img:(x=i.value.img)==null?void 0:x.filter(v=>v.status=="success").map(v=>{var S;return((S=v==null?void 0:v.response)==null?void 0:S.file)||v.url})}),y=new FormData;for(const v in s)Object.prototype.hasOwnProperty.call(s,v)&&(v=="img"?s[v].forEach((S,U)=>{y.append(`img[${U}]`,S)}):y.append(v,s[v]));(C=i.value)!=null&&C._id?(y.append("id",i.value._id),ye(y).then(()=>{o.value=!1,h("refresh")}).finally(()=>{b.value=!1})):ke(y).then(()=>{o.value=!1,h("refresh")}).finally(()=>{b.value=!1})})}const w=k([]);return W(()=>{_e().then(V=>{w.value=V.map(a=>({value:a.month,label:a.month,children:a.festivals.map(({festival:t})=>({value:t,label:t}))}))})}),(V,a)=>{var U;const t=d("el-input-number"),s=d("el-form-item"),y=d("el-input"),x=d("el-cascader"),C=d("el-form"),v=d("el-button"),S=d("el-dialog");return R(),X(S,{modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=m=>o.value=m),title:`${(U=c.data)!=null&&U._id?"编辑":"新增"}手抄报`,width:"500"},{footer:n(()=>[B("div",Be,[l(v,{onClick:a[5]||(a[5]=m=>o.value=!1)},{default:n(()=>a[8]||(a[8]=[_("取消")])),_:1}),l(v,{type:"primary",loading:b.value,onClick:L},{default:n(()=>a[9]||(a[9]=[_(" 确认 ")])),_:1},8,["loading"])])]),default:n(()=>[l(C,{ref_key:"ruleFormRef",ref:g,"label-position":"top",model:i.value,rules:F,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:n(()=>[l(s,{label:"星币",prop:"starCoin"},{default:n(()=>[l(t,{modelValue:i.value.starCoin,"onUpdate:modelValue":a[0]||(a[0]=m=>i.value.starCoin=m),min:0,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(s,{label:"标题",prop:"title"},{default:n(()=>[l(y,{modelValue:i.value.title,"onUpdate:modelValue":a[1]||(a[1]=m=>i.value.title=m),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(s,{label:"月分-节曰",prop:"monthFestival"},{default:n(()=>[l(x,{modelValue:i.value.monthFestival,"onUpdate:modelValue":a[2]||(a[2]=m=>i.value.monthFestival=m),options:w.value},null,8,["modelValue","options"])]),_:1}),l(s,{label:"百度云链接",prop:"baiduLink"},{default:n(()=>[l(y,{modelValue:i.value.baiduLink,"onUpdate:modelValue":a[3]||(a[3]=m=>i.value.baiduLink=m),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(s,{prop:"img"},{label:n(()=>a[7]||(a[7]=[_(" 上传 ")])),default:n(()=>[l(he,{modelValue:i.value.img,"onUpdate:modelValue":a[4]||(a[4]=m=>i.value.img=m),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),De={class:"flex"},Te={class:"head"},Ae={key:0,class:"imgBox"},$e={class:"table_operation"},Me=Q({name:"thandCopyList",__name:"index",props:{isStarCoin:{default:!1}},setup(f){const p=f,{columns:o,tableData:c,options:i,searchModel:h,handleSelectionChange:F,loadData:b,copyTextToClipboard:g,handDelete:L,headOperationAll:w,handUpper:V,handLower:a}=Re(p);W(()=>{b()});const t=k([]),s=k(),y=k(),x=()=>{var m,e;(e=(m=r(y).popperRef)==null?void 0:m.delayHide)==null||e.call(m)},C=k(!1),v=k({});function S(m){C.value=!0,v.value=m}function U(){C.value=!0,v.value={}}return(m,e)=>{const N=d("el-input"),D=d("el-button"),Z=d("el-image"),ee=d("el-tag"),le=d("Link"),T=d("el-icon"),ae=d("Remove"),te=d("Top"),oe=d("Bottom"),ne=d("Edit"),ie=d("pure-table"),se=d("el-cascader-panel"),ue=d("el-popover"),O=Se("click-outside");return R(),$(we,null,[B("div",De,[B("div",Te,[e[15]||(e[15]=B("div",null,"手抄报列表",-1)),B("div",null,[l(N,{modelValue:r(h).title,"onUpdate:modelValue":e[0]||(e[0]=u=>r(h).title=u),"suffix-icon":r(J),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l(N,{modelValue:r(h).month,"onUpdate:modelValue":e[1]||(e[1]=u=>r(h).month=u),"suffix-icon":r(J),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),l(N,{modelValue:r(h).baiduLink,"onUpdate:modelValue":e[2]||(e[2]=u=>r(h).baiduLink=u),"suffix-icon":r(J),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l(D,{type:"primary",onClick:r(b)},{default:n(()=>e[9]||(e[9]=[_("搜索")])),_:1},8,["onClick"]),l(D,{onClick:e[3]||(e[3]=u=>r(w)("upper"))},{default:n(()=>e[10]||(e[10]=[_("批量上架")])),_:1}),l(D,{onClick:e[4]||(e[4]=u=>r(w)("lower"))},{default:n(()=>e[11]||(e[11]=[_("批量下架")])),_:1}),p.isStarCoin?(R(),X(D,{key:0,onClick:e[5]||(e[5]=u=>r(w)("delete"))},{default:n(()=>e[12]||(e[12]=[_("批量删除")])),_:1})):Y("",!0),l(D,{type:"primary",onClick:e[6]||(e[6]=u=>r(w)("free"))},{default:n(()=>e[13]||(e[13]=[_(" 设置免费 ")])),_:1}),l(D,{type:"primary",onClick:U},{default:n(()=>e[14]||(e[14]=[_("新增")])),_:1})])]),l(ie,{"row-key":"id",data:r(c).list,loading:r(c).isLoading,columns:r(o),onSelectionChange:r(F)},{img:n(({row:u})=>[u!=null&&u.img?(R(),$("div",Ae,[l(Z,{"preview-teleported":!0,src:u.img[0],fit:"fill","preview-src-list":u.img},null,8,["src","preview-src-list"])])):Y("",!0)]),jointLevel1:n(()=>[H((R(),$("div",{ref_key:"buttonRef",ref:s},e[16]||(e[16]=[_("一级分类")]))),[[O,x]])]),jointLevel2:n(()=>[H((R(),$("div",null,e[17]||(e[17]=[_("二级分类")]))),[[O,x]])]),jointLevel3:n(()=>[H((R(),$("div",null,e[18]||(e[18]=[_("三级分类")]))),[[O,x]])]),state:n(()=>[l(ee,{type:"primary"},{default:n(()=>e[19]||(e[19]=[_("状态")])),_:1})]),operation:n(({row:u})=>[B("div",$e,[l(T,{onClick:M=>r(g)(u.baiduLink)},{default:n(()=>[l(le)]),_:2},1032,["onClick"]),l(T,{onClick:M=>r(L)(u._id)},{default:n(()=>[l(ae)]),_:2},1032,["onClick"]),l(T,{onClick:M=>r(V)(u._id)},{default:n(()=>[l(te)]),_:2},1032,["onClick"]),l(T,{onClick:M=>r(a)(u._id)},{default:n(()=>[l(oe)]),_:2},1032,["onClick"]),l(T,{onClick:M=>S(u)},{default:n(()=>[l(ne)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),l(ue,{ref_key:"popoverRef",ref:y,"virtual-ref":s.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:n(()=>[B("div",null,[l(se,{modelValue:t.value,"onUpdate:modelValue":e[7]||(e[7]=u=>t.value=u),props:{multiple:!0},options:r(i)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),l(Ue,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=u=>C.value=u),data:v.value,onRefresh:r(b)},null,8,["modelValue","data","onRefresh"])],64)}}}),qe=Fe(Me,[["__scopeId","data-v-abbc7b8c"]]);export{qe as default};
