var re=Object.defineProperty,se=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var H=(f,v,n)=>v in f?re(f,v,{enumerable:!0,configurable:!0,writable:!0,value:n}):f[v]=n,O=(f,v)=>{for(var n in v||(v={}))pe.call(v,n)&&H(f,n,v[n]);if(J)for(var n of J(v))me.call(v,n)&&H(f,n,v[n]);return f},j=(f,v)=>se(f,de(v));import{S as ve}from"./sortable.esm-DLvoQ0uI.js";import{c as fe,h as ce,a as be,o as A,R as ge,b as _e,d as ke}from"./index-BN7GPUcO.js";import{n as h,b as e,r as s,f as c,aF as Ce,aG as $,Y as ye,d as P,aH as K,aI as he,J as Ve,t as xe,g as Y,h as t,o as x,e as R,x as Le,c as w,u,V as z,Q as I,j as Se,aJ as F,R as we,w as q,_ as Re}from"./index-DAZ_A5gH.js";function Ue(f){const v=o=>{o.preventDefault(),ye(()=>{const m=document.querySelector(".el-table__body-wrapper tbody");ve.create(m,{animation:300,handle:".drag-btn",onEnd:({newIndex:y,oldIndex:L})=>{const p=n.value.list.splice(L,1)[0];n.value.list.splice(y,0,p)}})})},n=h({list:[],isLoading:!1}),b=h({title:"",month:"",baiduLink:""});f.isStarCoin&&(b.value.starCoin="0");function i(){n.value.isLoading=!0;const o={};for(let m in b.value)b.value[m]&&(o[m]=b.value[m]);ce(o).then(m=>{n.value.list=m.map(y=>(typeof y.img=="string"&&(y.img=y.img.split(",")),y))}).finally(()=>{n.value.isLoading=!1})}const k=h([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:o})=>e("div",{class:"flex items-center"},[e(s("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:m=>v(m)},null),e("p",{class:"ml-[16px]"},[o.id])])},{label:"封面",prop:"img",slot:"img"},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"星币数",prop:"starCoin",cellRenderer:({row:o})=>o.starCoin>0?o.starCoin:"免费"},{label:"状态",prop:"status",cellRenderer:({row:o})=>o.status?e(s("el-tag"),{type:"primary"},{default:()=>[c("上架")]}):e(s("el-tag"),{type:"danger"},{default:()=>[c("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),D=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],V=h([]);function _(o){V.value=[],V.value=o.map(({_id:m})=>m)}function a(o){Ce.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{be({id:o}).then(()=>{$.success("删除成功"),i()})}).catch(()=>{$.info("已取消删除")})}function C(o){var m;A[o]&&((m=A[o]({ids:JSON.stringify(V.value)}))==null||m.then(()=>{$.success("操作成功"),i()}))}function d(o){A.upper({ids:JSON.stringify([o])}).then(()=>{$.success("操作成功"),i()})}function g(o){A.upper({ids:JSON.stringify([o])}).then(()=>{$.success("操作成功"),i()})}return{columns:k,tableData:n,options:D,searchModel:b,handleSelectionChange:_,loadData:i,copyTextToClipboard:fe,handDelete:a,headOperationAll:C,handUpper:d,handLower:g}}const Be={class:"dialog-footer"},De=P({__name:"DialogForm",props:K({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:K(["refresh"],["update:modelValue"]),setup(f,{emit:v}){const n=he(f,"modelValue"),b=f,i=h({_id:"",starCoin:0,title:"",month:"",festival:"",baiduLink:"",img:[]});Ve(()=>n.value,()=>{var _;i.value=j(O({},b.data),{starCoin:Number(b.data.starCoin||0),img:(_=b.data.img)==null?void 0:_.map(a=>({url:a,status:"success"}))})});const k=v,D=xe({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],month:[{required:!0,message:"不可以为空"}],img:[{type:"array",required:!0,message:"不可以为空"}],festival:[{required:!0,message:"不可以为空"}]});function V(){var C;const _=j(O({},i.value),{img:i.value.img.map(d=>{var g;return((g=d==null?void 0:d.response)==null?void 0:g.file)||d.url})}),a=new FormData;for(const d in _)Object.prototype.hasOwnProperty.call(_,d)&&(d=="img"?_[d].forEach((g,o)=>{a.append(`img[${o}]`,g)}):a.append(d,_[d]));(C=i.value)!=null&&C._id?(a.append("id",i.value._id),_e(a).then(()=>{n.value=!1,k("refresh")})):ke(a).then(()=>{n.value=!1,k("refresh")})}return(_,a)=>{var L;const C=s("el-input-number"),d=s("el-form-item"),g=s("el-input"),o=s("el-form"),m=s("el-button"),y=s("el-dialog");return x(),Y(y,{modelValue:n.value,"onUpdate:modelValue":a[7]||(a[7]=p=>n.value=p),title:`${(L=b.data)!=null&&L._id?"编辑":"新增"}手抄报`,width:"500"},{footer:t(()=>[R("div",Be,[e(m,{onClick:a[6]||(a[6]=p=>n.value=!1)},{default:t(()=>a[9]||(a[9]=[c("取消")])),_:1}),e(m,{type:"primary",onClick:V},{default:t(()=>a[10]||(a[10]=[c(" 确认 ")])),_:1})])]),default:t(()=>[e(o,{ref:"ruleFormRef","label-position":"top",model:i.value,rules:D,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:t(()=>[e(d,{label:"星币",prop:"starCoin"},{default:t(()=>[e(C,{modelValue:i.value.starCoin,"onUpdate:modelValue":a[0]||(a[0]=p=>i.value.starCoin=p),min:0,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"标题",prop:"title"},{default:t(()=>[e(g,{modelValue:i.value.title,"onUpdate:modelValue":a[1]||(a[1]=p=>i.value.title=p),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"月分",prop:"month"},{default:t(()=>[e(g,{modelValue:i.value.month,"onUpdate:modelValue":a[2]||(a[2]=p=>i.value.month=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"节曰",prop:"festival"},{default:t(()=>[e(g,{modelValue:i.value.festival,"onUpdate:modelValue":a[3]||(a[3]=p=>i.value.festival=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"百度云链接",prop:"baiduLink"},{default:t(()=>[e(g,{modelValue:i.value.baiduLink,"onUpdate:modelValue":a[4]||(a[4]=p=>i.value.baiduLink=p),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{prop:"img"},{label:t(()=>a[8]||(a[8]=[c(" 上传 ")])),default:t(()=>[e(ge,{modelValue:i.value.img,"onUpdate:modelValue":a[5]||(a[5]=p=>i.value.img=p),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Te={class:"flex"},$e={class:"head"},Ae={key:0},Me={class:"table_operation"},Ee=P({name:"thandCopyList",__name:"index",props:{isStarCoin:{default:!1}},setup(f){const v=f,{columns:n,tableData:b,options:i,searchModel:k,handleSelectionChange:D,loadData:V,copyTextToClipboard:_,handDelete:a,headOperationAll:C,handUpper:d,handLower:g}=Ue(v);Le(()=>{V()});const o=h([]),m=h(),y=h(),L=()=>{var S,l;(l=(S=u(y).popperRef)==null?void 0:S.delayHide)==null||l.call(S)},p=h(!1),M=h({});function G(S){p.value=!0,M.value=S}function Q(){p.value=!0,M.value={}}return(S,l)=>{const E=s("el-input"),U=s("el-button"),W=s("el-image"),X=s("el-tag"),Z=s("Link"),T=s("el-icon"),ee=s("Remove"),le=s("Top"),ae=s("Bottom"),te=s("Edit"),oe=s("pure-table"),ne=s("el-cascader-panel"),ie=s("el-popover"),N=Se("click-outside");return x(),w(I,null,[R("div",Te,[R("div",$e,[l[15]||(l[15]=R("div",null,"手抄报列表",-1)),R("div",null,[e(E,{modelValue:u(k).title,"onUpdate:modelValue":l[0]||(l[0]=r=>u(k).title=r),"suffix-icon":u(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:u(k).month,"onUpdate:modelValue":l[1]||(l[1]=r=>u(k).month=r),"suffix-icon":u(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),e(E,{modelValue:u(k).baiduLink,"onUpdate:modelValue":l[2]||(l[2]=r=>u(k).baiduLink=r),"suffix-icon":u(F),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),e(U,{type:"primary",onClick:u(V)},{default:t(()=>l[9]||(l[9]=[c("搜索")])),_:1},8,["onClick"]),e(U,{onClick:l[3]||(l[3]=r=>u(C)("upper"))},{default:t(()=>l[10]||(l[10]=[c("批量上架")])),_:1}),e(U,{onClick:l[4]||(l[4]=r=>u(C)("lower"))},{default:t(()=>l[11]||(l[11]=[c("批量下架")])),_:1}),v.isStarCoin?(x(),Y(U,{key:0,onClick:l[5]||(l[5]=r=>u(C)("delete"))},{default:t(()=>l[12]||(l[12]=[c("批量删除")])),_:1})):z("",!0),e(U,{type:"primary",onClick:l[6]||(l[6]=r=>u(C)("free"))},{default:t(()=>l[13]||(l[13]=[c(" 设置免费 ")])),_:1}),e(U,{type:"primary",onClick:Q},{default:t(()=>l[14]||(l[14]=[c("新增")])),_:1})])]),e(oe,{"row-key":"id",data:u(b).list,loading:u(b).isLoading,columns:u(n),onSelectionChange:u(D)},{img:t(({row:r})=>[r!=null&&r.img?(x(),w("div",Ae,[(x(!0),w(I,null,we(r.img,(B,ue)=>(x(),w("div",{key:ue},[e(W,{src:B},null,8,["src"])]))),128))])):z("",!0)]),jointLevel1:t(()=>[q((x(),w("div",{ref_key:"buttonRef",ref:m},l[16]||(l[16]=[c("一级分类")]))),[[N,L]])]),jointLevel2:t(()=>[q((x(),w("div",null,l[17]||(l[17]=[c("二级分类")]))),[[N,L]])]),jointLevel3:t(()=>[q((x(),w("div",null,l[18]||(l[18]=[c("三级分类")]))),[[N,L]])]),state:t(()=>[e(X,{type:"primary"},{default:t(()=>l[19]||(l[19]=[c("状态")])),_:1})]),operation:t(({row:r})=>[R("div",Me,[e(T,{onClick:B=>u(_)(r.baiduLink)},{default:t(()=>[e(Z)]),_:2},1032,["onClick"]),e(T,{onClick:B=>u(a)(r._id)},{default:t(()=>[e(ee)]),_:2},1032,["onClick"]),e(T,{onClick:B=>u(d)(r._id)},{default:t(()=>[e(le)]),_:2},1032,["onClick"]),e(T,{onClick:B=>u(g)(r._id)},{default:t(()=>[e(ae)]),_:2},1032,["onClick"]),e(T,{onClick:B=>G(r)},{default:t(()=>[e(te)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),e(ie,{ref_key:"popoverRef",ref:y,"virtual-ref":m.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:t(()=>[R("div",null,[e(ne,{modelValue:o.value,"onUpdate:modelValue":l[7]||(l[7]=r=>o.value=r),props:{multiple:!0},options:u(i)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),e(De,{modelValue:p.value,"onUpdate:modelValue":l[8]||(l[8]=r=>p.value=r),data:M.value,onRefresh:u(V)},null,8,["modelValue","data","onRefresh"])],64)}}}),qe=Re(Ee,[["__scopeId","data-v-0502676d"]]);export{qe as default};
