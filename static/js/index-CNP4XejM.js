var ne=Object.defineProperty,ie=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var q=(m,p,i)=>p in m?ne(m,p,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[p]=i,M=(m,p)=>{for(var i in p||(p={}))re.call(p,i)&&q(m,i,p[i]);if(O)for(var i of O(p))se.call(p,i)&&q(m,i,p[i]);return m},E=(m,p)=>ie(m,ue(p));import{S as de}from"./sortable.esm-DLvoQ0uI.js";import{c as pe,h as me,a as ve,o as J,R as fe,b as be,d as ce}from"./index-DxGViQQ4.js";import{n as y,b as l,r as d,f,aF as ge,aG as j,Y as _e,d as I,aH as H,aI as ke,J as ye,t as Ve,g as P,h as o,o as C,e as R,x as Ce,c as w,u as s,V as K,Q as z,j as he,aJ as F,R as xe,w as N,_ as Le}from"./index-CKzzTDKE.js";function we(m){const p=a=>{a.preventDefault(),_e(()=>{const n=document.querySelector(".el-table__body-wrapper tbody");de.create(n,{animation:300,handle:".drag-btn",onEnd:({newIndex:c,oldIndex:h})=>{const x=i.value.list.splice(h,1)[0];i.value.list.splice(c,0,x)}})})},i=y({list:[],isLoading:!1}),b=y({title:"",month:"",baiduLink:""});m.isStarCoin&&(b.value.starCoin="0");function u(){i.value.isLoading=!0;const a={};for(let n in b.value)b.value[n]&&(a[n]=b.value[n]);me(a).then(n=>{i.value.list=n.map(c=>(typeof c.img=="string"&&(c.img=c.img.split(",")),c))}).finally(()=>{i.value.isLoading=!1})}const _=y([{type:"selection",align:"left"},{label:"序号",prop:"id",cellRenderer:({row:a})=>l("div",{class:"flex items-center"},[l(d("iconify-icon-online"),{icon:"icon-park-outline:drag",class:"drag-btn cursor-grab",onMouseenter:n=>p(n)},null),l("p",{class:"ml-[16px]"},[a.id])])},{label:"封面",prop:"img",slot:"img"},{label:"编号",prop:"number"},{label:"标题",prop:"title",width:300},{label:"一级分类",prop:"month",headerSlot:"jointLevel1"},{label:"二级分类",prop:"festival",headerSlot:"jointLevel2"},{label:"三级分类",prop:"name",headerSlot:"jointLevel3"},{label:"格式",prop:"starCoin"},{label:"星币数",prop:"starCoin",cellRenderer:({row:a})=>a.starCoin>0?a.starCoin:"免费"},{label:"状态",prop:"status",cellRenderer:({row:a})=>a.status?l(d("el-tag"),{type:"primary"},{default:()=>[f("上架")]}):l(d("el-tag"),{type:"danger"},{default:()=>[f("下架")]})},{label:"更新日期",prop:"name"},{label:"操作",prop:"name",width:200,slot:"operation"}]),B=[{value:1,label:"Asia",children:[{value:2,label:"China",children:[{value:3,label:"Beijing"},{value:4,label:"Shanghai"},{value:5,label:"Hangzhou"}]},{value:6,label:"Japan",children:[{value:7,label:"Tokyo"},{value:8,label:"Osaka"},{value:9,label:"Kyoto"}]},{value:10,label:"Korea",children:[{value:11,label:"Seoul"},{value:12,label:"Busan"},{value:13,label:"Taegu"}]}]},{value:14,label:"Europe",children:[{value:15,label:"France",children:[{value:16,label:"Paris"},{value:17,label:"Marseille"},{value:18,label:"Lyon"}]},{value:19,label:"UK",children:[{value:20,label:"London"},{value:21,label:"Birmingham"},{value:22,label:"Manchester"}]}]},{value:23,label:"North America",children:[{value:24,label:"US",children:[{value:25,label:"New York"},{value:26,label:"Los Angeles"},{value:27,label:"Washington"}]},{value:28,label:"Canada",children:[{value:29,label:"Toronto"},{value:30,label:"Montreal"},{value:31,label:"Ottawa"}]}]}],V=y([]);function g(a){V.value=[],V.value=a.map(({_id:n})=>n)}function t(a){ge.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ve({id:a}).then(()=>{j.success("删除成功"),u()})}).catch(()=>{j.info("已取消删除")})}function k(a){var n;J[a]&&((n=J[a]({ids:JSON.stringify(V.value)}))==null||n.then(()=>{j.success("操作成功"),u()}))}return{columns:_,tableData:i,options:B,searchModel:b,handleSelectionChange:g,loadData:u,copyTextToClipboard:pe,handDelete:t,headOperationAll:k}}const Re={class:"dialog-footer"},Se=I({__name:"DialogForm",props:H({data:{default:{_id:"",number:"",title:"",month:"",festival:"",baiduLink:"",img:[]}}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:H(["refresh"],["update:modelValue"]),setup(m,{emit:p}){const i=ke(m,"modelValue"),b=m,u=y({_id:"",starCoin:0,title:"",month:"",festival:"",baiduLink:"",img:[]});ye(()=>i.value,()=>{var g;u.value=E(M({},b.data),{starCoin:Number(b.data.starCoin||0),img:(g=b.data.img)==null?void 0:g.map(t=>({url:t,status:"success"}))})});const _=p,B=Ve({starCoin:[{required:!0,message:"不可以为空"}],title:[{required:!0,message:"不可以为空"}],baiduLink:[{required:!0,message:"不可以为空"}],month:[{required:!0,message:"不可以为空"}],img:[{type:"array",required:!0,message:"不可以为空"}],festival:[{required:!0,message:"不可以为空"}]});function V(){var k;const g=E(M({},u.value),{img:u.value.img.map(a=>{var n;return((n=a==null?void 0:a.response)==null?void 0:n.file)||a.url})}),t=new FormData;for(const a in g)Object.prototype.hasOwnProperty.call(g,a)&&(a=="img"?g[a].forEach((n,c)=>{t.append(`img[${c}]`,n)}):t.append(a,g[a]));(k=u.value)!=null&&k._id?(t.append("id",u.value._id),be(t).then(()=>{i.value=!1,_("refresh")})):ce(t).then(()=>{i.value=!1,_("refresh")})}return(g,t)=>{var U;const k=d("el-input-number"),a=d("el-form-item"),n=d("el-input"),c=d("el-form"),h=d("el-button"),x=d("el-dialog");return C(),P(x,{modelValue:i.value,"onUpdate:modelValue":t[7]||(t[7]=v=>i.value=v),title:`${(U=b.data)!=null&&U._id?"编辑":"新增"}手抄报`,width:"500"},{footer:o(()=>[R("div",Re,[l(h,{onClick:t[6]||(t[6]=v=>i.value=!1)},{default:o(()=>t[9]||(t[9]=[f("取消")])),_:1}),l(h,{type:"primary",onClick:V},{default:o(()=>t[10]||(t[10]=[f(" 确认 ")])),_:1})])]),default:o(()=>[l(c,{ref:"ruleFormRef","label-position":"top",model:u.value,rules:B,"label-width":"auto",class:"demo-ruleForm","status-icon":""},{default:o(()=>[l(a,{label:"星币",prop:"starCoin"},{default:o(()=>[l(k,{modelValue:u.value.starCoin,"onUpdate:modelValue":t[0]||(t[0]=v=>u.value.starCoin=v),min:0,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(a,{label:"标题",prop:"title"},{default:o(()=>[l(n,{modelValue:u.value.title,"onUpdate:modelValue":t[1]||(t[1]=v=>u.value.title=v),"show-word-limit":"",maxlength:"200",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(a,{label:"月分",prop:"month"},{default:o(()=>[l(n,{modelValue:u.value.month,"onUpdate:modelValue":t[2]||(t[2]=v=>u.value.month=v),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(a,{label:"节曰",prop:"festival"},{default:o(()=>[l(n,{modelValue:u.value.festival,"onUpdate:modelValue":t[3]||(t[3]=v=>u.value.festival=v),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(a,{label:"百度云链接",prop:"baiduLink"},{default:o(()=>[l(n,{modelValue:u.value.baiduLink,"onUpdate:modelValue":t[4]||(t[4]=v=>u.value.baiduLink=v),maxlength:"200",autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(a,{prop:"img"},{label:o(()=>t[8]||(t[8]=[f(" 上传 ")])),default:o(()=>[l(fe,{modelValue:u.value.img,"onUpdate:modelValue":t[5]||(t[5]=v=>u.value.img=v),name:"handCopy"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Be={class:"flex"},Ue={class:"head"},De={key:0},Te={class:"table_operation"},$e=I({name:"thandCopyList",__name:"index",props:{isStarCoin:{default:!1}},setup(m){const p=m,{columns:i,tableData:b,options:u,searchModel:_,handleSelectionChange:B,loadData:V,copyTextToClipboard:g,handDelete:t,headOperationAll:k}=we(p);Ce(()=>{V()});const a=y([]),n=y(),c=y(),h=()=>{var L,e;(e=(L=s(c).popperRef)==null?void 0:L.delayHide)==null||e.call(L)},x=y(!1),U=y({});function v(L){x.value=!0,U.value=L}return(L,e)=>{const $=d("el-input"),S=d("el-button"),Y=d("el-image"),G=d("el-tag"),Q=d("Link"),D=d("el-icon"),W=d("Remove"),X=d("Top"),Z=d("Bottom"),ee=d("Edit"),le=d("pure-table"),ae=d("el-cascader-panel"),te=d("el-popover"),A=he("click-outside");return C(),w(z,null,[R("div",Be,[R("div",Ue,[e[16]||(e[16]=R("div",null,"手抄报列表",-1)),R("div",null,[l($,{modelValue:s(_).title,"onUpdate:modelValue":e[0]||(e[0]=r=>s(_).title=r),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l($,{modelValue:s(_).month,"onUpdate:modelValue":e[1]||(e[1]=r=>s(_).month=r),"suffix-icon":s(F),style:{width:"150px","margin-right":"10px"},placeholder:"请输入月分"},null,8,["modelValue","suffix-icon"]),l($,{modelValue:s(_).baiduLink,"onUpdate:modelValue":e[2]||(e[2]=r=>s(_).baiduLink=r),"suffix-icon":s(F),style:{width:"150px","margin-right":"20px"},placeholder:"请输入标题"},null,8,["modelValue","suffix-icon"]),l(S,{type:"primary",onClick:s(V)},{default:o(()=>e[10]||(e[10]=[f("搜索")])),_:1},8,["onClick"]),l(S,{onClick:e[3]||(e[3]=r=>s(k)("upper"))},{default:o(()=>e[11]||(e[11]=[f("批量上架")])),_:1}),l(S,{onClick:e[4]||(e[4]=r=>s(k)("lower"))},{default:o(()=>e[12]||(e[12]=[f("批量下架")])),_:1}),p.isStarCoin?(C(),P(S,{key:0,onClick:e[5]||(e[5]=r=>s(k)("delete"))},{default:o(()=>e[13]||(e[13]=[f("批量删除")])),_:1})):K("",!0),l(S,{type:"primary",onClick:e[6]||(e[6]=r=>s(k)("free"))},{default:o(()=>e[14]||(e[14]=[f(" 设置免费 ")])),_:1}),l(S,{type:"primary",onClick:e[7]||(e[7]=r=>x.value=!0)},{default:o(()=>e[15]||(e[15]=[f("新增")])),_:1})])]),l(le,{"row-key":"id",data:s(b).list,loading:s(b).isLoading,columns:s(i),onSelectionChange:s(B)},{img:o(({row:r})=>[r!=null&&r.img?(C(),w("div",De,[(C(!0),w(z,null,xe(r.img,(T,oe)=>(C(),w("div",{key:oe},[l(Y,{src:T},null,8,["src"])]))),128))])):K("",!0)]),jointLevel1:o(()=>[N((C(),w("div",{ref_key:"buttonRef",ref:n},e[17]||(e[17]=[f("一级分类")]))),[[A,h]])]),jointLevel2:o(()=>[N((C(),w("div",null,e[18]||(e[18]=[f("二级分类")]))),[[A,h]])]),jointLevel3:o(()=>[N((C(),w("div",null,e[19]||(e[19]=[f("三级分类")]))),[[A,h]])]),state:o(()=>[l(G,{type:"primary"},{default:o(()=>e[20]||(e[20]=[f("状态")])),_:1})]),operation:o(({row:r})=>[R("div",Te,[l(D,{onClick:T=>s(g)(r.baiduLink)},{default:o(()=>[l(Q)]),_:2},1032,["onClick"]),l(D,{onClick:T=>s(t)(r._id)},{default:o(()=>[l(W)]),_:2},1032,["onClick"]),l(D,null,{default:o(()=>[l(X)]),_:1}),l(D,null,{default:o(()=>[l(Z)]),_:1}),l(D,{onClick:T=>v(r)},{default:o(()=>[l(ee)]),_:2},1032,["onClick"])])]),_:1},8,["data","loading","columns","onSelectionChange"]),l(te,{ref_key:"popoverRef",ref:c,"virtual-ref":n.value,width:"400px",trigger:"click","virtual-triggering":"",placement:"bottom-start"},{default:o(()=>[R("div",null,[l(ae,{modelValue:a.value,"onUpdate:modelValue":e[8]||(e[8]=r=>a.value=r),props:{multiple:!0},options:s(u)},null,8,["modelValue","options"])])]),_:1},8,["virtual-ref"])]),l(Se,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=r=>x.value=r),data:U.value,onRefresh:s(V)},null,8,["modelValue","data","onRefresh"])],64)}}}),Fe=Le($e,[["__scopeId","data-v-5de646a5"]]);export{Fe as default};
